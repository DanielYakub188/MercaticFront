<div class="container mt-4">

  <!-- üîé BUSCADOR -->
  <div class="mb-3">
    <input
      type="text"
      class="form-control"
      placeholder="Buscar productos..."
      [(ngModel)]="busqueda"
      (input)="filtrarProductos()"
    />
  </div>

  <table class="table table-striped table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>Imagen</th>
        <th>Producto</th>
        <th>Categor√≠a</th>
        <th>Precio</th>
        <th>Stock</th>
        <th>Formato</th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let p of productosPaginados">
        <td>
          <img
            [src]="'http://localhost:8080/uploads/productos/' + p.imagenUrl"
            alt="img"
            width="70"
            height="70"
            style="object-fit: cover; border-radius: 6px"
          />
        </td>

        <td>{{ p.nombreProducto }}</td>
        <td>{{ p.categoria }}</td>
        <td>{{ p.precio | currency : 'EUR' }}</td>
        <td>{{ p.stock }}</td>
        <td>{{ p.formatoProducto }}</td>

        <td>
          <button class="btn btn-success btn-sm" (click)="abrirModal(p)">
            Modificar
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- üåê PAGINACI√ìN -->
  <div class="d-flex justify-content-between align-items-center mt-3">

    <button
      class="btn btn-outline-primary"
      (click)="paginaAnterior()"
      [disabled]="paginaActual === 0"
    >
      ‚¨ÖÔ∏è Anterior
    </button>

    <span>P√°gina {{ paginaActual + 1 }} / {{ totalPaginas }}</span>

    <button
      class="btn btn-outline-primary"
      (click)="paginaSiguiente()"
      [disabled]="paginaActual >= totalPaginas - 1"
    >
      Siguiente ‚û°Ô∏è
    </button>

  </div>
  <br><br><br>
</div>


<!-- MODAL -->
<div
  class="modal fade"
  id="modalEditarProducto"
  tabindex="-1"
  aria-hidden="true"
  *ngIf="productoEdit"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Modificar producto</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>

      <div class="modal-body">
        <form>
          <div class="row mb-3">
            <div class="col-md-4">
              <img
                [src]="imagenPreview || ('http://localhost:8080/uploads/productos/' + productoEdit?.imagenUrl)"
                class="img-fluid border rounded"
                style="max-height: 150px; object-fit: cover"
              />
              <input
                type="file"
                class="form-control mt-2"
                (change)="onImagenSeleccionada($event)"
              />
            </div>

            <div class="col-md-8">
              <label class="form-label">Nombre</label>
              <input
                class="form-control"
                [(ngModel)]="productoEdit.nombreProducto"
                name="nombreProducto"
              />

              <label class="form-label mt-3">Precio</label>
              <input
                type="number"
                step="0.01"
                class="form-control"
                [(ngModel)]="productoEdit.precio"
                name="precio"
              />
              <label class="form-label mt-3">Unidades / Stock</label>
              <input
                type="number"
                class="form-control"
                [(ngModel)]="productoEdit.stock"
                name="stock"
              />

              <label class="form-label mt-3">Formato</label>
              <input
                class="form-control"
                [(ngModel)]="productoEdit.formatoProducto"
                name="formatoProducto"
              />

              <label class="form-label mt-3">Categor√≠a</label>
              <input
                class="form-control"
                [(ngModel)]="productoEdit.categoria"
                name="categoria"
              />
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer d-flex justify-content-between">
        <button
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Cancelar
        </button>

        <div>
          <button class="btn btn-danger me-2" (click)="borrarProducto()">
            Borrar
          </button>

          <button class="btn btn-success" (click)="guardarCambios()">
            Guardar Cambios
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
